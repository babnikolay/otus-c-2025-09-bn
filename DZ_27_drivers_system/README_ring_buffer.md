Создание Makefile
Создайте файл с именем Makefile в той же директории, где находится ваш файл ring_buffer.c
obj-m += ring_buffer.o

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean


Компиляция модуля
В терминале, в каталоге с вашими файлами, выполните следующую команду:
make

Эта команда скомпилирует модуль ядра и создаст файл ring_buffer.ko.

Установка модуля
Для загрузки модуля в ядро используйте команду insmod:
sudo insmod ring_buffer.ko

Чтобы убедиться в том, что модуль загружен успешно, используйте команду:
lsmod | grep ring_buffer

Если вы видите ваше имя модуля в выводе, значит он был успешно загружен.

Создание устройства
Модуль автоматически создаст специальное устройство (в нашем случае ring_buffer_device) в /dev. Вы можете проверить это с помощью команды:
ls /dev/ring_buffer_device

Настройка через sysfs
Созданный вами модуль поддерживает настройку через sysfs. Вы можете изменить максимальный размер кольцевого буфера, выполнив следующую команду:
echo 2048 > /sys/class/ring_buffer_class/ring_buffer_device/size

Тестирование операций чтения и записи
Для тестирования вы можете использовать простые команды echo и cat:

Запись в буфер:
echo "Hello, World!" > /dev/ring_buffer_device

Чтение из буфера:
cat /dev/ring_buffer_device


Удаление модуля
Для освобождения ресурсов необходимо удалить модуль:
sudo rmmod ring_buffer

Очистка
Если вы хотите удалить собранные файлы, выполните:
make clean
